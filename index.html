<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Announcements & Quick Start — Casual MITEC</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<style>
  :root{
    --mitec-gold:#D4AF37;
    --mitec-mid:#224289;
    --bg:#f7f9fc;
    --card:#ffffff;
    --muted:#55606a;
    --radius:12px;
    --accent:#0b78ff;
    --carousel-interval:6000; /* ms */
    --step-duration:900;      /* ms (fast) */
    --spin-speed: 0.9s;       /* shiny ring spin */
  }

  *{box-sizing:border-box}
  body{
    font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    background:var(--bg);
    margin:0;
    color:#101827;
    padding:28px;
  }

  .wrap{max-width:1080px;margin:0 auto;display:grid;grid-template-columns:1fr;gap:18px}
  @media(min-width:980px){ .wrap{grid-template-columns:1fr 420px} }

  .card{background:var(--card);border-radius:var(--radius);padding:18px;box-shadow:0 10px 30px rgba(12,18,30,0.06)}

  /* ---------- ANNOUNCEMENTS CAROUSEL ---------- */
  .ann-outer{position:relative}
  .ann-title{display:flex;align-items:center;gap:10px;color:var(--mitec-mid);font-weight:700;margin-bottom:12px;font-size:1.05rem}
  .ann-title i{transform-origin:center; animation:icon-bob 4s ease-in-out infinite}
  @keyframes icon-bob{0%{transform:translateY(0)}50%{transform:translateY(-4px)}100%{transform:translateY(0)}}

  .carousel {
    position:relative;
    overflow:hidden;
    border-radius:10px;
    background:linear-gradient(180deg,#fbfbfe,#fcfdff);
    padding:12px;
  }

  .slides{position:relative;height:140px;}
  .slide{
    position:absolute;
    inset:0;
    opacity:0;
    transform:translateY(6px);
    transition:opacity 420ms ease, transform 420ms cubic-bezier(.2,.9,.2,1);
    display:flex;
    gap:12px;
    align-items:flex-start;
    padding:12px;
  }
  .slide[aria-hidden="false"]{ opacity:1; transform:none; z-index:2; }

  .slide h3{margin:0;font-size:1rem;color:#0f172a}
  .slide p{margin:8px 0 0;color:var(--muted);line-height:1.45;display:-webkit-box;-webkit-line-clamp:4;-webkit-box-orient:vertical;overflow:hidden}

  .controls{display:flex;gap:8px;align-items:center;margin-top:12px;justify-content:space-between}
  .dots{display:flex;gap:8px;align-items:center}
  .dot{width:10px;height:10px;border-radius:50%;background:#e6eefb;cursor:pointer;border:1px solid #dbeafc}
  .dot[aria-current="true"]{background:var(--mitec-mid);box-shadow:0 6px 16px rgba(34,66,137,0.12)}
  .nav-btn{background:transparent;border:1px solid #e6eefb;padding:8px;border-radius:8px;cursor:pointer}

  .skeleton{height:96px;border-radius:10px;background:linear-gradient(90deg,#f0f3f8 0%, #e8edf6 50%, #f0f3f8 100%);background-size:200% 100%;animation:shimmer 1.1s linear infinite}
  @keyframes shimmer{from{background-position:200% 0}to{background-position:-200% 0}}

  /* ---------- QUICK-STEP with shiny circling borders ---------- */
  .quick-start .title{font-size:1.15rem;font-weight:800;margin-bottom:14px;display:flex;align-items:center;gap:8px;color:var(--mitec-mid)}
  .steps{display:grid;grid-template-columns:repeat(2,1fr);gap:12px}
  @media(max-width:540px){ .steps{grid-template-columns:1fr} }

  a.step {
    text-decoration:none;
    color:inherit;
    position:relative;
    border-radius:12px;
    padding:14px 14px 14px 12px;
    display:flex;
    gap:12px;
    align-items:center;
    background:linear-gradient(180deg,#fff,#fcfdff);
    border:1px solid #eef5ff;
    cursor:pointer;
    transition:transform 180ms ease, box-shadow 180ms ease;
    outline:none;
  }
  a.step:focus{box-shadow:0 8px 30px rgba(11,120,255,0.12);transform:translateY(-3px)}
  a.step:hover{transform:translateY(-6px);box-shadow:0 18px 40px rgba(9,14,30,0.06)}
  a.step.paused{opacity:0.94;transform:none;box-shadow:none}

  .step .content{flex:1}
  .step .title{font-weight:800;margin:0;color:#0b1330}
  .step .sub{margin:6px 0 0;color:var(--muted);font-size:0.92rem}

  .circle-wrap { width:62px; height:62px; flex:0 0 62px; position:relative; display:grid;place-items:center }
  .circle-wrap::before{
    content:"";
    position:absolute;
    inset:-4px;
    border-radius:999px;
    padding:4px;
    z-index:0;
    background: conic-gradient(from 0deg, rgba(212,175,55,0.12), rgba(212,175,55,0.22), rgba(11,120,255,0.18), rgba(34,66,137,0.22), rgba(212,175,55,0.12));
    filter: drop-shadow(0 6px 20px rgba(11,120,255,0.06));
    transform: rotate(0deg);
    animation: spinShine var(--spin-speed) linear infinite;
  }
  @keyframes spinShine{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}

  .circle-wrap svg { width:62px;height:62px; position:relative; z-index:1; transform:rotate(-90deg); }
  .circle-bg { stroke: #eef5ff; stroke-width:6; fill:none; }
  .progress { stroke: var(--mitec-mid); stroke-width:6; fill:none; stroke-linecap:round; stroke-dasharray: 314; stroke-dashoffset: 314; transition: stroke-dashoffset var(--step-duration) linear; }

  .cnum{position:absolute;font-weight:900;color:var(--mitec-mid);font-size:0.95rem;z-index:2;pointer-events:none}

  a.step.paused .circle-wrap::before{animation-play-state:paused; filter: drop-shadow(0 4px 10px rgba(11,120,255,0.04));}
  a.step.paused .progress{transition:none}

  a.step:nth-child(1) .circle-wrap::before{animation-delay:0s}
  a.step:nth-child(2) .circle-wrap::before{animation-delay:0.12s}
  a.step:nth-child(3) .circle-wrap::before{animation-delay:0.24s}
  a.step:nth-child(4) .circle-wrap::before{animation-delay:0.36s}

  @media (prefers-reduced-motion: reduce){
    .slide{transition:none}
    .ann-title i{animation:none}
    .circle-wrap::before{animation:none}
    .progress{transition:none; stroke-dashoffset:0}
  }

  /* small footer */
  footer{grid-column:1/-1;text-align:center;color:var(--muted);margin-top:8px;font-size:0.9rem}
</style>
</head>
<body>

<div class="wrap">
  <!-- ANNOUNCEMENTS CAROUSEL -->
  <div class="card ann-outer" aria-labelledby="ann">
    <div class="ann-title">
      <i class="fa-solid fa-bullhorn" style="color:var(--mitec-mid)"></i>
      Announcements & Updates
    </div>

    <div class="carousel" id="carousel" aria-roledescription="carousel">
      <div class="slides" id="slides">
        <!-- skeleton slides while loading -->
        <div class="slide skeleton" role="group" aria-hidden="true"></div>
        <div class="slide skeleton" role="group" aria-hidden="true"></div>
        <div class="slide skeleton" role="group" aria-hidden="true"></div>
      </div>

      <div class="controls" style="margin-top:12px">
        <div>
          <button class="nav-btn" id="prevBtn" aria-label="Previous announcement"><i class="fa-solid fa-chevron-left"></i></button>
          <button class="nav-btn" id="nextBtn" aria-label="Next announcement"><i class="fa-solid fa-chevron-right"></i></button>
        </div>
        <div class="dots" id="dots" role="tablist" aria-label="Announcement pages"></div>
      </div>
    </div>
  </div>

  <!-- QUICK START with shiny circling border sequence (links restored) -->
  <div class="card quick-start" aria-labelledby="qs">
    <div class="title"><i class="fa-solid fa-flag" style="color:var(--mitec-gold)"></i> Get Your Payment — 4 quick steps</div>

    <div class="steps" id="steps">
      <a class="step" href="http://www.casualmitec.online/first-time-application" target="_self" rel="noopener" data-step="0" aria-label="Step 1 - Register">
        <div class="circle-wrap">
          <svg viewBox="0 0 100 100" aria-hidden="true">
            <circle class="circle-bg" cx="50" cy="50" r="49"></circle>
            <circle class="progress" cx="50" cy="50" r="50"></circle>
          </svg>
          <div class="cnum">1</div>
        </div>
        <div class="content">
          <div class="title">Register</div>
          <div class="sub">Submit your bank details</div>
        </div>
      </a>

      <a class="step" href="http://www.casualmitec.online/sign-in-sign-out" target="_self" rel="noopener" data-step="1" aria-label="Step 2 - Sign In/Out">
        <div class="circle-wrap">
          <svg viewBox="0 0 100 100" aria-hidden="true">
            <circle class="circle-bg" cx="50" cy="50" r="49"></circle>
            <circle class="progress" cx="50" cy="50" r="50"></circle>
          </svg>
          <div class="cnum">2</div>
        </div>
        <div class="content">
          <div class="title">Sign In / Out</div>
          <div class="sub">Clock in and out for every shift</div>
        </div>
      </a>

      <a class="step" href="http://eus-cdn.sway.static.microsoft/s/RZPlGrjCXdD5QeF2/images/NCPljCf2-Hl4r0?quality=479&allowAnimation=true&embeddedHost=true&filterEffectsFormula=Grayscale=0,Contrast=1.15" target="_blank" rel="noopener" data-step="2" aria-label="Step 3 - Submit Voucher">
        <div class="circle-wrap">
          <svg viewBox="0 0 100 100" aria-hidden="true">
            <circle class="circle-bg" cx="50" cy="50" r="49"></circle>
            <circle class="progress" cx="50" cy="50" r="50"></circle>
          </svg>
          <div class="cnum">3</div>
        </div>
        <div class="content">
          <div class="title">Submit Voucher</div>
          <div class="sub">Hand voucher to guard for payment</div>
        </div>
      </a>

      <a class="step" href="http://www.casualmitec.online/my-record" target="_self" rel="noopener" data-step="3" aria-label="Step 4 - Check Record">
        <div class="circle-wrap">
          <svg viewBox="0 0 100 100" aria-hidden="true">
            <circle class="circle-bg" cx="50" cy="50" r="49"></circle>
            <circle class="progress" cx="50" cy="50" r="50"></circle>
          </svg>
          <div class="cnum">4</div>
        </div>
        <div class="content">
          <div class="title">Check Record</div>
          <div class="sub">Verify clocking & payments</div>
        </div>
      </a>
    </div>

    <div style="margin-top:14px;color:var(--muted);font-size:0.92rem">
      Tip: keep your bank details current — payments follow the registered account.
    </div>
  </div>

  <footer>© Malaysia International Trade & Exhibition Centre — CasualMITEC</footer>
</div>

<script>
/* ===============================
   ANNOUNCEMENTS CAROUSEL LOGIC
   =============================== */
(async function(){
  const sheetId = "1Gks45PK53pcPJXePjYlRLpAhAmGPMPB3X0ec5XaLgRI";
  const slidesEl = document.getElementById('slides');
  const dotsEl = document.getElementById('dots');
  const prevBtn = document.getElementById('prevBtn');
  const nextBtn = document.getElementById('nextBtn');
  const carouselInterval = parseInt(getComputedStyle(document.documentElement).getPropertyValue('--carousel-interval')) || 6000;
  let items = [];
  let current = 0;
  let timer = null;
  let isPaused = false;

  function escapeHtml(str=''){ return String(str).replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); }

  async function fetchSheetRows(){
    const url = `https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?tqx=out:json&sheet=${encodeURIComponent('Sheet1')}`;
    try{
      const res = await fetch(url);
      const txt = await res.text();
      const json = JSON.parse(txt.substr(47).slice(0,-2));
      return json.table.rows || [];
    }catch(e){
      console.error('sheet fetch err',e);
      return [];
    }
  }

  function buildSlides(rows){
    items = rows.map(r => {
      const text = r.c && r.c[0] ? String(r.c[0].v) : '';
      const date = r.c && r.c[1] ? String(r.c[1].v) : '';
      return { text, date };
    });

    slidesEl.innerHTML = '';
    dotsEl.innerHTML = '';

    if(!items.length){
      slidesEl.innerHTML = '<div class="slide"><div style="padding:18px;color:var(--muted)">No announcements.</div></div>';
      return;
    }

    items.forEach((it, idx) => {
      const s = document.createElement('div');
      s.className = 'slide';
      s.setAttribute('role','group');
      s.setAttribute('aria-hidden','true');
      s.id = 'slide-' + idx;
      s.innerHTML = `
        <div style="flex:1">
          <h3>${escapeHtml(it.text.split('\\n')[0] || it.text)}</h3>
          <p>${escapeHtml(it.text.length>300 ? it.text.slice(0,300)+'…': it.text)}</p>
        </div>
      `;
      slidesEl.appendChild(s);

      const dot = document.createElement('button');
      dot.className = 'dot';
      dot.type = 'button';
      dot.setAttribute('aria-label','Go to announcement '+(idx+1));
      dot.setAttribute('aria-current','false');
      dot.addEventListener('click', ()=> goTo(idx, true));
      dotsEl.appendChild(dot);
    });
  }

  function setActive(index){
    const slideEls = slidesEl.querySelectorAll('.slide');
    const dotEls = dotsEl.querySelectorAll('.dot');
    slideEls.forEach((s,i)=>{
      s.setAttribute('aria-hidden', i===index ? 'false' : 'true');
    });
    dotEls.forEach((d,i)=>{
      d.setAttribute('aria-current', i===index ? 'true' : 'false');
    });
    current = index;
  }

  function goTo(index, userTriggered=false){
    if(!items.length) return;
    setActive((index+items.length) % items.length);
    restartTimer();
    if(userTriggered) pauseAuto();
  }

  function next(){ goTo((current + 1) % items.length); }
  function prev(){ goTo((current - 1 + items.length) % items.length); }

  function startTimer(){
    if(timer) clearInterval(timer);
    timer = setInterval(()=> { if(!isPaused) next(); }, carouselInterval);
  }
  function restartTimer(){ startTimer(); }

  function pauseAuto(){
    isPaused = true;
    clearInterval(timer);
    setTimeout(()=>{ isPaused = false; startTimer(); }, 8000);
  }

  const carouselEl = document.getElementById('carousel');
  carouselEl.addEventListener('mouseenter', () => { isPaused = true; });
  carouselEl.addEventListener('mouseleave', () => { isPaused = false; });
  carouselEl.addEventListener('focusin', () => { isPaused = true; });
  carouselEl.addEventListener('focusout', () => { isPaused = false; });

  prevBtn.addEventListener('click', ()=>{ prev(); pauseAuto(); });
  nextBtn.addEventListener('click', ()=>{ next(); pauseAuto(); });

  (function addSwipe(){
    let x0 = null;
    carouselEl.addEventListener('touchstart', e => { x0 = e.changedTouches[0].clientX; });
    carouselEl.addEventListener('touchend', e => {
      if(!x0) return;
      const dx = e.changedTouches[0].clientX - x0;
      if(Math.abs(dx) > 40){
        if(dx > 0) prev(); else next();
        pauseAuto();
      }
      x0 = null;
    });
  })();

  // init
  const rows = await fetchSheetRows();
  buildSlides(rows);
  if(items.length) setActive(0);
  startTimer();

})();

/* ===========================================
   STEP SEQUENCE: shiny circling border (fast)
   =========================================== */
(function(){
  const stepsContainer = document.getElementById('steps');
  const steps = Array.from(stepsContainer.querySelectorAll('a.step'));
  const duration = parseInt(getComputedStyle(document.documentElement).getPropertyValue('--step-duration')) || 900;
  let current = 0;
  let running = true;
  let timeoutId = null;
  const prefersReduced = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
  const PROGRESS_CIRC = 314; // approx circumference for r=50

  function initProgress(){
    steps.forEach(s=>{
      const prog = s.querySelector('.progress');
      if(prog){
        prog.style.strokeDasharray = PROGRESS_CIRC;
        prog.style.strokeDashoffset = PROGRESS_CIRC;
        prog.style.transition = `stroke-dashoffset ${duration}ms linear`;
      }
    });
  }

  function resetAll(){
    steps.forEach(s => {
      s.classList.remove('active','paused');
      const prog = s.querySelector('.progress');
      if(prog){
        prog.classList.remove('running');
        prog.style.transition = `stroke-dashoffset ${duration}ms linear`;
        prog.style.strokeDashoffset = PROGRESS_CIRC;
      }
    });
  }

  function animateStep(idx){
    if(prefersReduced) return;
    resetAll();
    const s = steps[idx];
    if(!s) return;
    const prog = s.querySelector('.progress');
    s.classList.add('active');
    requestAnimationFrame(()=> {
      prog.classList.add('running');
      prog.style.strokeDashoffset = 0;
    });

    timeoutId = setTimeout(()=> {
      current = (idx + 1) % steps.length;
      animateStep(current);
    }, duration + 60); // small gap
  }

  if(!prefersReduced){
    initProgress();
    animateStep(0);
  } else {
    steps.forEach(s=>{
      const prog = s.querySelector('.progress');
      if(prog) prog.style.strokeDashoffset = 0;
    });
  }

  function pauseSequence(){
    if(prefersReduced) return;
    running = false;
    clearTimeout(timeoutId);
    steps.forEach(s=>{
      s.classList.add('paused');
      const prog = s.querySelector('.progress');
      if(prog){
        const cs = getComputedStyle(prog);
        const dash = cs.strokeDashoffset || cs.getPropertyValue('stroke-dashoffset');
        prog.style.transition = 'none';
        const numeric = parseFloat(dash);
        if(!isNaN(numeric)) prog.style.strokeDashoffset = numeric;
      }
    });
  }
  function resumeSequence(){
    if(prefersReduced) return;
    if(running) return;
    running = true;
    steps.forEach(s => {
      const prog = s.querySelector('.progress');
      if(prog){
        prog.style.transition = `stroke-dashoffset ${duration}ms linear`;
        prog.style.strokeDashoffset = PROGRESS_CIRC;
      }
    });
    animateStep(current);
  }

  steps.forEach((s, idx)=>{
    s.addEventListener('mouseenter', pauseSequence);
    s.addEventListener('mouseleave', resumeSequence);
    s.addEventListener('focusin', pauseSequence);
    s.addEventListener('focusout', resumeSequence);
    // NOTE: no click handler here — anchors navigate immediately by browser default
    // however, ensure ctrl/meta openness still works (browser handles it)
  });

})();
</script>

</body>
</html>
